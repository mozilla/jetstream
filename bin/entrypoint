#!/bin/bash

set -e

if [ "$1" = "export-statistics-to-json" ]; then
    # this is triggered by Airflow
    jetstream export-statistics-to-json
elif [ "$1" = "rerun-config-changed" ]; then
    # this is triggered by the jetstream-config repo
    jetstream rerun-config-changed --argo
elif [ "$1" = "run" ]; then
    # argo
    jetstream --log_to_bigquery run "${@:2}"
else
    # this is triggered by Airflow
    jetstream --log_to_bigquery run "$@" --argo
    jetstream --log_to_bigquery rerun-config-changed --argo
fi
